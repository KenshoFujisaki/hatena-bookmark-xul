<bindings xmlns="http://www.mozilla.org/xbl"
          xmlns:xbl="http://www.mozilla.org/xbl"
          xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">

    <binding id="addPanel">
        <content>
            <vbox xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
                  flex="1" style="height: 20em;">
                <grid>
                    <columns>
                        <column/>
                        <column flex="1"/>
                    </columns>
                    <rows>
                        <row>
                            <label>タイトル:</label>
                            <textbox anonid="title" readonly="true"/>
                        </row>
                        <row>
                            <label>URL:</label>
                            <label anonid="url" class="text-link"/>
                        </row>
                        <row>
                            <label>コメント:</label>
                            <textbox anonid="comment" type="autocomplete"
                                     class="hbookmark-commenttextbox"
                                     autocompletesearch="hbookmark-tag"
                                     showcommentcolumn="true"
                                     ontextentered="this.adjustCaret(true);"
                                     onsearchcomplete="this.memoCaret();"/>
                        </row>
                    </rows>
                </grid>

                <hbox>
                    <button label="追加する"/>
                </hbox>
            </vbox>
        </content>

        <implementation>
            <field name="view">null</field>
            <field name="targetBrowser">null</field>

            <field name="_titleField">
                document.getAnonymousElementByAttribute(this, "anonid", "title")
            </field>
            <field name="_urlField">
                document.getAnonymousElementByAttribute(this, "anonid", "url")
            </field>
            <field name="_commentField">
                document.getAnonymousElementByAttribute(this, "anonid", "comment")
            </field>

            <!-- XXX This should be false -->
            <field name="_isOpen">true</field>
            <property name="isOpen" readonly="true"
                      onget="return this._isOpen"/>

            <method name="toggle">
                <body>
                <![CDATA[
                    let wasOpen = this.isOpen;
                    if (!wasOpen) {
                        this.view.setup(this.targetBrowser.contentWindow);
                        this._update();
                    }
                    this.collapsed = wasOpen;
                    this._isOpen = !wasOpen;
                ]]>
                </body>
            </method>

            <method name="_update">
                <body>
                <![CDATA[
                    this._titleField.value = this.view.title;
                    this._urlField.value = this.view.url;
                    this._urlField.setAttribute("href", this.view.url);
                    this._commentField.value = this.view.comment;
                ]]>
                </body>
            </method>
        </implementation>
    </binding>

</bindings>
